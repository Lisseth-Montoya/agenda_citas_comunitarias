{% extends 'layout/base.html' %}

{% block title %}Especialidades{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/especialidades.css') }}">
{% endblock %}

{% block content %}

<div class="container-fluid">
    <a class="navbar-brand" href="#">Agenda Médica</a>
</div>

<div class="container py-4">

    <!-- ============================= -->
    <!-- FILTROS -->
    <!-- ============================= -->
    <div class="card shadow-sm mb-4 p-3">
        <h5 class="mb-3">Filtros</h5>
        <div class="row g-3">

            <div class="col-md-3">
                <label class="form-label">Especialidad</label>
                <select id="filterEspecialidad" class="form-select">
                    <option value="">Todas</option>
                </select>
            </div>

            <div class="col-md-3">
                <label class="form-label">Profesional</label>
                <select id="filterProfesional" class="form-select">
                    <option value="">Todos</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Estado</label>
                <select id="filterEstado" class="form-select">
                    <option value="">Todos</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="confirmada">Confirmada</option>
                    <option value="cancelada">Cancelada</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Fecha</label>
                <input type="date" id="filterFecha" class="form-control">
            </div>

            <div class="col-md-2 d-flex align-items-end">
                <button id="btnLimpiarFiltros" class="btn btn-secondary w-100">Limpiar</button>
            </div>

        </div>
    </div>

    <!-- ============================= -->
    <!-- BOTÓN NUEVA CITA -->
    <!-- ============================= -->
    <div class="d-flex justify-content-between mb-3">
        <h4 class="fw-bold">Calendario</h4>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCita">
            <i class="fa fa-plus me-1"></i> Nueva Cita
        </button>
    </div>

    <!-- ============================= -->
    <!-- CALENDARIO -->
    <!-- ============================= -->
    <div class="card shadow-sm p-3">
        <h5 id="weekLabel" class="mb-3">Semana actual</h5>

        <div class="d-flex justify-content-between mb-3">
            <button id="prevWeek" class="btn btn-outline-primary btn-sm">◀ Semana anterior</button>
            <button id="nextWeek" class="btn btn-outline-primary btn-sm">Siguiente semana ▶</button>
        </div>

        <div id="calendarGrid" class="calendar-grid">
            <!-- JS inserta los días -->
        </div>

        <p class="mt-3 text-muted" id="todaySummary"></p>
    </div>

    <!-- ============================= -->
    <!-- LISTADO -->
    <!-- ============================= -->
    <div class="card shadow-sm mt-4 p-3" id="listado">
        <h5 class="mb-3">Listado de citas</h5>

        <div class="table-responsive">
            <table id="tablaCitas" class="table table-striped table-hover text-center">
                <thead class="table-primary">
                    <tr>
                        <th>#</th>
                        <th>Especialidad</th>
                        <th>Profesional</th>
                        <th>Paciente</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Duración</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- ====================================================== -->
<!-- MODAL CREAR / EDITAR CITA -->
<!-- ====================================================== -->
<div class="modal fade" id="modalCita" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCitaLabel">Nueva cita</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form id="formCita" novalidate>
                <input type="hidden" id="citaId">

                <div class="modal-body">
                    <div class="row g-3">

                        <div class="col-md-6">
                            <label class="form-label">Especialidad</label>
                            <select id="especialidad" class="form-select" required>
                                <option value="">Seleccionar...</option>
                            </select>
                            <div class="invalid-feedback">Selecciona una especialidad.</div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Profesional</label>
                            <select id="profesional" class="form-select" required>
                                <option value="">Seleccionar...</option>
                            </select>
                            <div class="invalid-feedback">Selecciona un profesional.</div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Paciente / Solicitante</label>
                            <input id="paciente" type="text" class="form-control" required>
                            <div class="invalid-feedback">Ingresa el nombre.</div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Fecha</label>
                            <input id="fecha" type="date" class="form-control" required>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Hora</label>
                            <input id="hora" type="time" class="form-control" required>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Duración (min)</label>
                            <input id="duracion" type="number" class="form-control" min="5" required>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Estado</label>
                            <select id="estado" class="form-select" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="confirmada">Confirmada</option>
                                <option value="cancelada">Cancelada</option>
                            </select>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Notas</label>
                            <textarea id="notas" class="form-control" rows="3"></textarea>
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- ====================================================== -->
<!-- MODAL DETALLE DE CITA -->
<!-- ====================================================== -->
<div class="modal fade" id="modalDetalle" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Detalle de cita</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p><strong>Especialidad:</strong> <span id="d_especialidad"></span></p>
                <p><strong>Profesional:</strong> <span id="d_profesional"></span></p>
                <p><strong>Paciente:</strong> <span id="d_paciente"></span></p>
                <p><strong>Fecha y Hora:</strong> <span id="d_fecha_hora"></span></p>
                <p><strong>Duración:</strong> <span id="d_duracion"></span></p>
                <p><strong>Estado:</strong> <span id="d_estado"></span></p>
                <p><strong>Notas:</strong> <span id="d_notas"></span></p>
            </div>

            <div class="modal-footer">
                <button class="btn btn-warning" id="btnReprogramar">Reprogramar</button>
                <button class="btn btn-danger" id="btnCancelarCita">Cancelar</button>
            </div>

        </div>
    </div>
</div>

{% endblock %}
